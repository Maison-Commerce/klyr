<style>
  .product-info__product-videos {
    display: flex;
    flex-direction: column;
    row-gap: 24px;
  }
  .__product-videos-top {
    text-align: center;
  }
  .__product-videos-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    column-gap: 8px;
  }
  .product-video-section-item {
    position: relative;
    cursor: pointer;
  }
  .product-video-section-item .play {
    position: absolute;
    z-index: 1;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }
  .product-video-section-item .play svg {
    width: 35px;
    height: 35px;
    color: #ffffff;
  }
  .product-video-section-item .play svg:hover {
    color: rgba(255, 255, 255, 0.8);
  }

  .product-block__video-slider .video-popup {
    position: relative;
    display: none;
  }
  .product-block__video-slider .video-popup__container {
    width: auto;
    height: auto;
    position: fixed;
    left: 20px;
    bottom: 100px;
    z-index: 3;
    overflow: hidden;
    border-radius: 24px;
  }
  .video-popup span {
    z-index: 4;
    position: absolute;
    background-color: rgba(0, 0, 0, .2);
    border-radius: 50%;
    top: 20px;
    left: 20px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }
  .video-popup span svg {
    z-index: 4;
    width: 18px;
    height: 18px;
    color: rgb(255, 255, 255);
  }
  .video-popup video {
    border-radius: 24px;
    max-width: 370px;
    max-height: 600px;
    z-index: 3;
    position: relative;
  }
  .video-popup__container .sound {
    background: rgba(0, 0, 0, 0);
    border: none;
    cursor: pointer;
    border-radius: 100px;
    backdrop-filter: blur(10px);
    transition: --duration-medium;
    width: 40px;
    height: 40px;
    position: absolute;
    bottom: 140px;
    right: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 3;
  }
  .video-popup__container .play-stop {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: none;
    z-index: 3;
  }
  .video-popup__container .play-stop svg {
    cursor: pointer;
    transition: all .3s
  }
  .video-popup__container .play-stop svg:hover {
    transform: scale(1.2)
  }

  @media screen and (max-height: 700px) {
    .video-popup video {
      max-height: 75vh;
    }
  }
  @media screen and (max-width: 1023px) {
    .product-block__video-slider .video-popup__container {
      bottom: 10px;
    }
  }
</style>

<div class="product__block product-block__video-slider" {{ block.shopify_attributes }}>
  <div class="product-info__product-videos">
    <div class="__product-videos-top">
      <h4 class="font-base uppercase">{{ block.settings.title }}</h4>
    </div>
    <div class="__product-videos-container">
      <div class="__product-videos-grid">
        {% for i in (1..10) %}
        {% assign key = "video_" | append: i %}
        {% assign video = block.settings[key] %}
        {% if video != blank %}
        <div class="product-video-section-item" data-video-url="{{ video.sources[1].url }}">
          {{ video
          | video_tag:
          image_size: 'master',
          autoplay: false,
          loop: false,
          muted: true,
          controls: false,
          class: 'thumbnail-video'
          }}
          <span class="play">
            {% comment %} <svg class="" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none">
              <path
                d="M4 3.532c0-1.554 1.696-2.514 3.029-1.715l14.113 8.468c1.294.777 1.294 2.653 0 3.43L7.029 22.183c-1.333.8-3.029-.16-3.029-1.715V3.532Z"
                fill="#fff"></path>
            </svg> {% endcomment %}
            <svg xmlns="http://www.w3.org/2000/svg" width="19" height="23" viewBox="0 0 19 23" fill="none">
              <path d="M19 11.5L0.249998 22.3253V0.674682L19 11.5Z" fill="currentColor" />
            </svg>
          </span>
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="video-popup">
    <div class="video-popup__container">
      <span class="video-popup__close">
        <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M16.055 16.594a.662.662 0 0 1-.899 0L10 11.398l-5.195 5.196a.662.662 0 0 1-.899 0 .662.662 0 0 1 0-.899L9.102 10.5 3.906 5.344a.662.662 0 0 1 0-.899.662.662 0 0 1 .899 0L10 9.641l5.156-5.196a.662.662 0 0 1 .899 0 .662.662 0 0 1 0 .899L10.859 10.5l5.196 5.195a.662.662 0 0 1 0 .899Z"
            style="fill: #FFFFFF !important;">
          </path>
        </svg>
      </span>
      <video src="" autoplay="" playsinline=""></video>
      <button class="sound" id="muteButton">
        <svg width="20" height="17" viewBox="0 0 22 19" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M11.758.867A1.349 1.349 0 0 0 11.25.75c-.313 0-.625.117-.86.352L5.118 5.75H1.875C.82 5.75 0 6.61 0 7.625v3.71c0 1.017.82 1.837 1.875 1.837h3.242l5.274 4.687c.234.313.546.391.859.391.156 0 .313 0 .508-.078.43-.235.742-.664.742-1.172V2c0-.469-.313-.938-.742-1.133Zm-1.133 14.766-4.766-4.258H1.875v-3.71h3.984l4.766-4.259v12.227Zm5.469-9.024a1.053 1.053 0 0 0-.586-.195.962.962 0 0 0-.742.352.942.942 0 0 0 .156 1.328c.43.351.703.86.703 1.406a1.85 1.85 0 0 1-.703 1.445.942.942 0 0 0-.156 1.328.962.962 0 0 0 .742.352c.195 0 .43-.078.586-.195.898-.742 1.406-1.797 1.406-2.93 0-1.094-.508-2.148-1.406-2.89Zm2.383-2.89c-.196-.117-.391-.196-.625-.196-.274 0-.508.118-.704.352-.351.39-.273.977.118 1.328 1.328 1.055 2.109 2.656 2.109 4.297 0 1.68-.781 3.281-2.11 4.336-.39.351-.468.937-.117 1.328.196.234.43.352.704.352.234 0 .43-.079.625-.196 1.757-1.445 2.773-3.554 2.773-5.82 0-2.227-1.016-4.336-2.773-5.781Z"
            fill="#fff"></path>
        </svg>
      </button>
      <button class="sound" id="unmuteButton" style="display: none;">
        <svg width="20" height="20" viewBox="0 0 24 19" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M12.508.867C12.313.79 12.156.79 12 .79c-.313 0-.625.078-.86.313L5.868 5.75H2.625C1.57 5.75.75 6.61.75 7.625v3.71c0 1.017.82 1.837 1.875 1.837h3.242l5.274 4.687c.234.196.546.313.859.313.156 0 .313-.04.508-.117.43-.196.703-.664.703-1.133V2c0-.469-.274-.938-.703-1.133Zm-1.133 14.766-4.766-4.258H2.625v-3.71h3.984l4.766-4.259v12.227ZM20.789 9.5l1.836-1.836c.39-.39.39-.976 0-1.328-.352-.39-.938-.39-1.328 0L19.5 8.21l-1.875-1.875c-.39-.352-.977-.352-1.328 0-.39.39-.39.976 0 1.328L18.133 9.5l-1.836 1.836c-.39.39-.39.976 0 1.328.351.39.937.39 1.328 0l1.875-1.836 1.836 1.836c.352.39.937.39 1.289 0 .39-.351.39-.937 0-1.328L20.789 9.5Z"
            fill="#fff"></path>
        </svg>
      </button>
      <div class="play-stop">
        <svg width="90" height="90" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M50.387 85.167c-3.142 0-5.387-2.47-5.387-5.387V40.275C45 37.469 47.245 35 50.387 35c.898 0 1.908.224 2.806.786l32.322 19.752c1.571.898 2.581 2.694 2.581 4.49 0 1.907-1.01 3.703-2.581 4.6L53.193 84.382a5.33 5.33 0 0 1-2.806.786Z"
            fill="#fff"></path>
        </svg>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const videoItems = document.querySelectorAll('.product-video-section-item');
    const videoPopup = document.querySelector('.video-popup');
    const videoElement = videoPopup.querySelector('video');
    const closeBtn = videoPopup.querySelector('.video-popup__close');
    const muteButton = document.getElementById('muteButton');
    const unmuteButton = document.getElementById('unmuteButton');
    const playStop = document.querySelector('.play-stop');

    let isMuted = false;

    videoItems.forEach(item => {
      item.addEventListener('click', function () {
        const videoUrl = this.getAttribute('data-video-url');
        if (videoUrl) {
          videoElement.src = videoUrl;
          videoElement.muted = isMuted;
          videoPopup.style.display = 'block';
          videoPopup.classList.add('active');
          playStop.style.display = 'block';
          setTimeout(() => {
            playStop.style.display = 'none';
            videoElement.play();
          }, 500);
        }
      });
    });

    closeBtn.addEventListener('click', function () {
      videoElement.pause();
      videoElement.src = '';
      videoPopup.style.display = 'none';
      videoPopup.classList.remove('active');
      playStop.style.display = 'none';
    });

    muteButton.addEventListener('click', function () {
      isMuted = true;
      videoElement.muted = true;
      muteButton.style.display = 'none';
      unmuteButton.style.display = 'flex';
    });

    unmuteButton.addEventListener('click', function () {
      isMuted = false;
      videoElement.muted = false;
      unmuteButton.style.display = 'none';
      muteButton.style.display = 'flex';
    });

    videoElement.addEventListener('click', function () {
      if (videoElement.paused) {
        videoElement.play();
        playStop.style.display = 'none';
      } else {
        videoElement.pause();
        playStop.style.display = 'block';
      }
    });

    playStop.addEventListener('click', function () {
      if (videoElement.paused) {
        videoElement.play();
        playStop.style.display = 'none';
      } else {
        videoElement.pause();
        playStop.style.display = 'block';
      }
    });

    document.body.addEventListener('click', function (event) {
      if(videoPopup.classList.contains('active') && !videoPopup.contains(event.target) && !event.target.closest('.product-video-section-item')) {
        closeBtn.click();
      }
    });
  });
</script>